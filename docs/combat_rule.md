
## 🎯 **전체 공격 플로우**

```
1단계: 명중 판정 (Hit Check)
2단계: 데미지 계산 (Damage Calculation)  
3단계: 방어력 적용 (Defense Application)
4단계: 최종 데미지 확정 (Final Damage)
```

---

## ⚔️ **1단계: 명중 판정 (To-Hit Roll)**

### **기본 공식**
```
명중 굴림 = 1d20 + 공격자 명중 보너스
회피 굴림 = 1d20 + 방어자 회피 보너스

명중 성공 = (명중 굴림 >= 회피 굴림)
```

### **명중 보너스 구성**
```
공격자 명중 보너스 = 
  + DEX modifier (민첩 보정값)
  + 무기 숙련도 보너스
  + 명중 관련 스킬 보너스
  + 기타 버프/마법 보너스
```

### **회피 보너스 구성**
```
방어자 회피 보너스 = 
  + DEX modifier (민첩 보정값)  
  + 회피/방어 스킬 보너스
  + 방어구 회피 보너스 (가벼운 갑옷)
  + 기타 버프/마법 보너스
```

### **명중 스킬 예시**
- `WEAPON_FOCUS`: 특정 무기 명중 +1
- `POINT_BLANK_SHOT`: 근거리 원거리 무기 명중 +1
- `PRECISE_SHOT`: 엄호 상대 공격시 명중 +2
- `COMBAT_EXPERTISE`: 명중 -1~-5, 회피 +1~+5 (조절 가능)

---

## 💪 **2단계: 기본 데미지 계산**

### **근접 무기 데미지**
```
기본 데미지 = 무기 데미지 + STR modifier + 기타 보너스
```

### **원거리 무기 데미지**
```
기본 데미지 = 무기 데미지 + (일부 무기는 STR/DEX modifier) + 기타 보너스
```

### **STR 수치 설계안**
- **시작 능력치**: 8-18 (3d6 굴림 또는 포인트 배분)
- **레벨당 증가**: 4레벨마다 +1 (D&D 방식)
- **최대치 목표**:
    - 인간 한계: ~25 (전설적 영웅)
    - 신적 존재: ~30+ (아티팩트/신의 축복)

### **STR Modifier 테이블**
```
STR 점수  | Modifier | 설명
---------|----------|----------
1        | -5       | 극도로 허약
6-7      | -2       | 허약
8-9      | -1       | 약간 허약  
10-11    | +0       | 평범
12-13    | +1       | 약간 강함
14-15    | +2       | 강함
16-17    | +3       | 매우 강함
18-19    | +4       | 뛰어남
20-21    | +5       | 전설적
22-23    | +6       | 영웅적
24-25    | +7       | 신화적
26+      | +8       | 신적
```

### **무기 데미지 예시**
```
무기 타입        | 기본 데미지 | 특성
---------------|------------|------------
단검 (Dagger)   | 1d4       | 경량, 투척 가능
숏소드         | 1d6       | 균형잡힌 무기
롱소드         | 1d8       | 다용도 무기  
그레이트소드    | 2d6       | 양손무기, 고데미지
메이스         | 1d6       | 둔기, 갑옷 관통
워해머         | 1d8       | 둔기, 갑옷 관통
활 (Short)     | 1d6       | 원거리
활 (Long)      | 1d8       | 원거리, 장거리
석궁          | 1d8       | 원거리, 관통력
```

---

## 🛡️ **3단계: 방어력 적용**

### **방어력 타입**
1. **물리 방어력 (AC - Armor Class)**
2. **마법 방어력 (Magic Resistance)**
3. **관통 저항력 (Penetration Resistance)**

### **물리 방어력 계산**
```
총 AC = 기본 AC + 방어구 AC + DEX modifier + 기타 보너스

기본 AC = 10 (D&D 방식)
방어구 AC = 갑옷 종류별 고정값
DEX modifier = 민첩에 따른 보너스 (갑옷별 최대치 제한)
```

### **방어구 예시**
```
방어구 타입      | AC 보너스 | DEX 최대 | 특성
---------------|----------|----------|----------
가죽 갑옷       | +2       | +6       | 경갑, 이동 자유
스터디드 레더   | +3       | +5       | 경갑  
체인메일       | +5       | +2       | 중갑, 소음
스플린트       | +6       | +0       | 중갑
플레이트       | +8       | +1       | 중갑, 최고 방어
```

### **데미지 감소 공식**
```
방어 적용 데미지 = max(1, 기본 데미지 - 방어력)

또는 백분율 방식:
방어 적용 데미지 = 기본 데미지 × (1 - 방어율)
방어율 = min(0.8, AC / (AC + 50))  // 최대 80% 감소
```

---

## 🗡️ **4단계: 관통력 시스템**

### **관통력 메커니즘**
```
유효 방어력 = max(0, 방어력 - 관통력)
최종 데미지 = max(1, 기본 데미지 - 유효 방어력)
```

### **관통력 소스**
- **무기 자체**: 관통형 무기 (찌르기, 화살)
- **스킬**: `ARMOR_PIERCING` 특기
- **마법 부여**: +1~+5 관통력 무기
- **특수 공격**: 급소 공격, 기습 공격

### **관통력 예시**
```
무기/스킬              | 관통력 | 설명
---------------------|--------|----------
일반 베기 무기        | 0      | 기본
찌르기 무기 (검, 창)   | 1-2    | 약간의 관통
석궁, 활             | 2-3    | 원거리 관통
Armor Piercing 특기   | +2     | 스킬 보너스
마법 무기 +1         | +1     | 마법 관통력
크리티컬 히트        | +3     | 급소 공격
```

---

## 🎲 **5단계: 특수 상황**

### **크리티컬 히트**
```
크리티컬 조건: 명중 굴림이 자연 20 또는 무기별 크리티컬 범위
크리티컬 효과: 
  - 데미지 주사위 2배 굴림
  - 또는 고정 데미지 × 크리티컬 배수
  - 관통력 +3 보너스
```

### **크리티컬 실패**
```
실패 조건: 명중 굴림이 자연 1
실패 효과:
  - 자동 빗나감
  - 무기 내구도 감소 (선택사항)
  - 반격 기회 제공 (선택사항)
```

### **상성 시스템**
```
무기 타입 vs 방어구:
- 둔기 vs 플레이트: 관통력 +2 (충격 데미지)
- 찌르기 vs 체인메일: 관통력 +1 (틈새 공격)
- 베기 vs 가죽갑옷: 데미지 +2 (절단력)
```

---

## 📊 **전체 공식 요약**

```
=== 최종 데미지 계산 ===

1. 명중 판정:
   명중 성공 = (1d20 + 공격자 명중 보너스) >= (1d20 + 방어자 회피 보너스)

2. 기본 데미지:
   기본 데미지 = 무기 데미지 + STR modifier + 기타 보너스

3. 관통 적용:
   유효 방어력 = max(0, 방어력 - 관통력)

4. 최종 데미지:
   최종 데미지 = max(1, 기본 데미지 - 유효 방어력)

5. 특수 상황:
   - 크리티컬: 데미지 2배, 관통력 +3
   - 상성 보너스: 무기-방어구 조합별 추가 효과
```
